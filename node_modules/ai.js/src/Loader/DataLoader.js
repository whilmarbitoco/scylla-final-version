var fs = require('fs');
var Data = require('../Data/Data.js');
var csvParser = require('csv-parse/lib/sync');

var DataLoader = {
    load: function (argument) {
        var filePath = argument['filePath'];
        var labelName = argument['labelName'];
        var fileContent = fs.readFileSync(filePath);
        var rawRows = csvParser(fileContent);
        var attributeNames = rawRows[0];
        var rows = rawRows.splice(1);
        var labelIndex = attributeNames.reduce((pre, now, index) => {
            if (pre >= 0) {
                return pre;
            }
            if (now == labelName) {
                return index;
            }
            return -1;
        }, -1);
        attributeNames.splice(labelIndex, 1);
        var labels = [];
        for (var i in rows) {
            labels.push(rows[i].splice(labelIndex, 1)[0]);
        }
        return Data.createData({rows, attributeNames, labels, labelName});
    },
    help: function () {
        console.log('I\'m DataLoader!');
    }
};

module.exports = DataLoader;
